@using System.Globalization

<div class="mb-3">
    @if (!string.IsNullOrEmpty(Label))
    {
        <label for="@Id" class="form-label">@Label</label>
    }
    <div class="input-group">
        <input type="number" 
               class="form-control @CssClass" 
               id="@Id" 
               step="@Step" 
               placeholder="@Placeholder"
               value="@FormattedValue"
               @onchange="OnValueChanged"
               disabled="@Disabled" />
        
        @if (!string.IsNullOrEmpty(Unit))
        {
            <span class="input-group-text">@Unit</span>
        }
    </div>
    @if (!string.IsNullOrEmpty(HelpText))
    {
        <div class="form-text">@HelpText</div>
    }
</div>

@code {
    [Parameter] public string Id { get; set; } = Guid.NewGuid().ToString();
    [Parameter] public string Label { get; set; } = string.Empty;
    [Parameter] public double Value { get; set; }
    [Parameter] public EventCallback<double> ValueChanged { get; set; }
    [Parameter] public string Unit { get; set; } = string.Empty;
    [Parameter] public string Step { get; set; } = "any";
    [Parameter] public string Placeholder { get; set; } = string.Empty;
    [Parameter] public string HelpText { get; set; } = string.Empty;
    [Parameter] public bool Disabled { get; set; } = false;
    [Parameter] public string CssClass { get; set; } = string.Empty;

    private string FormattedValue => Value.ToString(CultureInfo.InvariantCulture);

    private async Task OnValueChanged(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), NumberStyles.Any, CultureInfo.InvariantCulture, out var result))
        {
            Value = result;
            await ValueChanged.InvokeAsync(Value);
        }
    }
}
